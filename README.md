# FX Markup Simulator

A plain HTML + JavaScript demo that simulates FX markup outcomes with automatic FX rate lookup from locally stored ECB reference data.

## What it does

The page collects:
- Transaction amount (TxAmt)
- Transaction currency (dropdown)
- Settlement currency (dropdown)
- FX rate (BaseRate, auto-filled and read-only)
- FX markup % (MarkupPct)

When you click **Run Settlement Agent**, it will:
1. Calculate merchant net payout
2. Calculate FX margin earned
3. Show a decision explanation
4. Show a **Calculation Breakdown** table with each formula step

## Automatic FX rate data

Rates are read from `fx_rates.json`, generated by `scripts/update_fx_rates.py`.

The UI displays:
- Source
- As-of date
- Derivation note (direct / inversion / EUR cross-rate)

Lookup logic:
1. Use direct rate if available
2. Else derive by inversion if reverse rate exists
3. Else derive by EUR cross-rate: `A→B = (EUR→B) / (EUR→A)`
4. Else show an error and disable the run button

## Validation rules

- Amount must be **> 0**
- FX rate must be **> 0**
- FX markup % must be **>= 0**

If inputs are invalid, an error message is shown and calculations are not run.

## Run locally

1. Update rates:

```bash
python3 scripts/update_fx_rates.py
```

2. Start a local server:

```bash
python3 -m http.server 8000
```

3. Open:

- http://localhost:8000

## GitHub Actions automation

A daily workflow at `.github/workflows/update-fx.yml` refreshes `fx_rates.json` and commits changes to `main` with message:

- `chore: update fx rates`

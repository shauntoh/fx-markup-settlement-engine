<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agentic Settlement Engine</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 2rem;
        max-width: 760px;
        line-height: 1.4;
      }
      h1 {
        margin-bottom: 0.5rem;
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(180px, 1fr));
        gap: 0.75rem;
      }
      label {
        display: flex;
        flex-direction: column;
        font-size: 0.9rem;
      }
      input,
      select,
      button {
        margin-top: 0.35rem;
        padding: 0.45rem;
        font-size: 1rem;
      }
      button {
        cursor: pointer;
      }
      .results p {
        margin: 0.4rem 0;
      }
      .muted {
        color: #555;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <h1>Agentic Settlement Engine</h1>
    <p class="muted">A lightweight demo to simulate settlement outcomes.</p>

    <div class="card">
      <div class="grid">
        <label>
          Transaction amount
          <input id="amount" type="number" min="0" step="0.01" value="1000" />
        </label>

        <label>
          Transaction currency
          <input id="txnCurrency" type="text" value="USD" maxlength="3" />
        </label>

        <label>
          Settlement currency
          <input id="settlementCurrency" type="text" value="EUR" maxlength="3" />
        </label>

        <label>
          FX rate
          <input id="fxRate" type="number" min="0" step="0.0001" value="0.92" />
        </label>

        <label>
          FX markup %
          <input id="fxMarkup" type="number" min="0" step="0.01" value="1.25" />
        </label>

        <label>
          Settlement speed
          <select id="settlementSpeed">
            <option value="T+1">T+1</option>
            <option value="T+3">T+3</option>
          </select>
        </label>

        <label>
          Cross-border flag
          <select id="crossBorder">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </label>
      </div>

      <button id="runButton" type="button" style="margin-top: 1rem">
        Run Settlement Agent
      </button>
    </div>

    <div class="card results" id="results" aria-live="polite">
      <p><strong>Merchant net payout:</strong> -</p>
      <p><strong>FX margin earned:</strong> -</p>
      <p><strong>Settlement timing:</strong> -</p>
      <p><strong>Decision explanation:</strong> -</p>
    </div>

    <script>
      const amountEl = document.getElementById('amount');
      const txnCurrencyEl = document.getElementById('txnCurrency');
      const settlementCurrencyEl = document.getElementById('settlementCurrency');
      const fxRateEl = document.getElementById('fxRate');
      const fxMarkupEl = document.getElementById('fxMarkup');
      const settlementSpeedEl = document.getElementById('settlementSpeed');
      const crossBorderEl = document.getElementById('crossBorder');
      const runButton = document.getElementById('runButton');
      const results = document.getElementById('results');

      function toMoney(value, currency) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency,
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }).format(value);
      }

      runButton.addEventListener('click', () => {
        const amount = Number(amountEl.value);
        const txnCurrency = txnCurrencyEl.value.toUpperCase();
        const settlementCurrency = settlementCurrencyEl.value.toUpperCase();
        const fxRate = Number(fxRateEl.value);
        const fxMarkupPct = Number(fxMarkupEl.value);
        const settlementSpeed = settlementSpeedEl.value;
        const crossBorder = crossBorderEl.value;

        if (!amount || !fxRate || amount < 0 || fxRate < 0) {
          alert('Please enter valid positive numeric values for amount and FX rate.');
          return;
        }

        // Base converted amount in settlement currency before markup.
        // Formula: convertedBase = transactionAmount * fxRate
        const convertedBase = amount * fxRate;

        // FX margin represents the provider's markup revenue in settlement currency.
        // Formula: fxMargin = convertedBase * (fxMarkupPct / 100)
        const fxMargin = convertedBase * (fxMarkupPct / 100);

        // Merchant net payout is what the merchant receives after markup is retained.
        // Formula: merchantNetPayout = convertedBase - fxMargin
        const merchantNetPayout = convertedBase - fxMargin;

        // Settlement timing is a direct reflection of selected settlement speed.
        const settlementTiming =
          settlementSpeed === 'T+1' ? 'Funds settle by next business day (T+1).' : 'Funds settle in three business days (T+3).';

        const explanation =
          crossBorder === 'yes'
            ? `Cross-border flow detected: ${txnCurrency} converted to ${settlementCurrency} at ${fxRate}. A ${fxMarkupPct}% markup generated margin while preserving a net payout for the merchant.`
            : `Domestic flow selected: settlement kept straightforward with ${settlementSpeed} timing and transparent FX markup application.`;

        results.innerHTML = `
          <p><strong>Merchant net payout:</strong> ${toMoney(merchantNetPayout, settlementCurrency)}</p>
          <p><strong>FX margin earned:</strong> ${toMoney(fxMargin, settlementCurrency)}</p>
          <p><strong>Settlement timing:</strong> ${settlementTiming}</p>
          <p><strong>Decision explanation:</strong> ${explanation}</p>
        `;
      });
    </script>
  </body>
</html>
